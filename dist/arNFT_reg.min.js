!function(){"use strict";var e=function(e,t,i){this.width=e,this.height=t,this.root=new THREE.Object3D,this.root.matrixAutoUpdate=!1,this.config=i,this.version="0.3.0",console.log("ARnft ",this.version)};e.prototype.init=function(a,n){console.log("ARnft init() %cstart...","color: yellow; background-color: blue; border-radius: 4px; padding: 2px");this.cameraPara;var o=this.root;(async function(e,t){return await new Promise((function(t,i){const a=new XMLHttpRequest;a.open("GET",e),a.responseType="json",a.onload=function(){t(a.response)},a.onerror=function(){i("error "+a.status)},a.send(null)}))})(this.config).then((function(r){!function(e){var t=document.createElement("div");t.id="loading";var i=document.createElement("img");i.src=e.loading.logo.src,i.alt=e.loading.logo.alt;var a=document.createElement("span");a.setAttribute("class","loading-text"),a.innerText=e.loading.loadingMessage,t.appendChild(i),t.appendChild(a);document.getElementById("marker");document.body.insertBefore(t,document.body.firstChild)}(r),function(e){if(e){var t=document.createElement("div");t.id="stats",t.className="ui stats";var i=document.createElement("div");i.id="stats1",i.className="stats-item";var a=document.createElement("p");a.className="stats-item-title",a.innerText="Main",i.appendChild(a),t.appendChild(i);var n=document.createElement("div");n.id="stats2",n.className="stats-item";var o=document.createElement("p");o.className="stats-item-title",o.innerText="Worker",n.appendChild(o),t.appendChild(n);var r=document.getElementById("loading");document.body.insertBefore(t,r)}}(n);var d,s,c=function(){var e=document.createElement("div");e.id="app";var t=document.createElement("canvas");t.id="canvas";var i=document.createElement("video");i.id="video",i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.setAttribute("playsinline",""),e.appendChild(i),e.appendChild(t);var a=document.getElementById("loading");return document.body.insertBefore(e,a),{container:e,canvas:t,video:i}}(),l=(c.container,c.canvas),m=c.video;n&&((d=new Stats).showPanel(0),document.getElementById("stats1").appendChild(d.dom),(s=new Stats).showPanel(0),document.getElementById("stats2").appendChild(s.dom)),function(a,n,o,r,d,s,c){var l=c.videoSettings.facingMode||"environment",m=c.onError||function(e){console.error("ARnft internal getUserMedia",e)},u=!1,v=["touchstart","touchend","touchmove","touchcancel","click","mousedown","mouseup","mousemove","keydown","keyup","keypress","scroll"],g=function(){u&&(o.play().then((function(){!function(e,a,n,o,r,d,s,c,l,m){var u,v,g,h,p,f,w,E,y,x,b,M,S,k=document.createElement("canvas"),U=k.getContext("2d"),R=new THREE.WebGLRenderer({canvas:d,alpha:m.renderer.alpha,antialias:m.renderer.antialias,precision:m.renderer.precision});R.setPixelRatio(window.devicePixelRatio);var T=new THREE.Scene,A=new THREE.Camera;A.matrixAutoUpdate=!1,T.add(A);var H=new THREE.AmbientLight(16777215);T.add(H),T.add(l);var C,I=function(e){C=e?JSON.parse(e.matrixGL_RH):null},j=Date.now();function L(){U.fillStyle="black",U.fillRect(0,0,y,x),U.drawImage(n,0,0,u,v,b,M,w,E);var e=U.getImageData(0,0,y,x);S.postMessage({type:"process",imagedata:e},[e.data.buffer])}var W=function(){P(),requestAnimationFrame(W)},P=function(){s();var e=Date.now();if(e-j,j=e,C){l.visible=!0;for(var a=0;a<16;a++)t.delta[a]=C[a]-t.interpolated[a],t.interpolated[a]=t.interpolated[a]+t.delta[a]/24;i(l.matrix,t.interpolated)}else l.visible=!1;R.render(T,A)};u=o,v=r,p=320/Math.max(u,v/3*4),f=/Android|mobile|iPad|iPhone/i.test(navigator.userAgent)?window.outerWidth/o:1,g=u*f,h=v*f,w=u*p,E=v*p,y=Math.max(w,E/3*4),x=Math.max(E,w/4*3),b=(y-w)/2,M=(x-E)/2,k.style.clientWidth=y+"px",k.style.clientHeight=x+"px",k.width=y,k.height=x,R.setSize(g,h),(S=new Worker(m.workerUrl)).postMessage({type:"load",pw:y,ph:x,camera_para:m.cameraPara,marker:a,artoolkitUrl:m.artoolkitUrl}),S.onmessage=function(e){var t=e.data;switch(t.type){case"loaded":var a=JSON.parse(t.proj),n=y/w,o=x/E;a[0]*=n,a[4]*=n,a[8]*=n,a[12]*=n,a[1]*=o,a[5]*=o,a[9]*=o,a[13]*=o,i(A.projectionMatrix,a);break;case"endLoading":if(1==t.end){var r=document.getElementById("loading");r&&(r.querySelector(".loading-text").innerText="Start the tracking!",setTimeout((function(){r.parentElement.removeChild(r)}),2e3))}break;case"found":I(t);break;case"not found":I(null)}c(),L()},W(),L()}(0,n,o,o.videoWidth,o.videoHeight,r,(function(){s.stats&&s.statsMain.update()}),(function(){s.stats&&s.statsWorker.update()}),d,c)})).catch((function(t){m(t),e._teardownVideo(o)})),o.paused||v.forEach((function(e){window.removeEventListener(e,g,!0)})))};v.forEach((function(e){window.addEventListener(e,g,!0)}));var h=function(e){if(window.URL.createObjectURL)try{o.srcObject=e}catch(e){}o.srcObject=e,u=!0,o.autoplay=!0,o.playsInline=!0,g()},p={},f={};c.videoSettings.width&&(f.width=c.videoSettings.width,"object"==typeof c.videoSettings.width?(c.videoSettings.width.max&&(p.maxWidth=c.videoSettings.width.max),c.videoSettings.width.min&&(p.minWidth=c.videoSettings.width.min)):p.maxWidth=c.videoSettings.width);c.videoSettings.height&&(f.height=c.videoSettings.height,"object"==typeof c.videoSettings.height?(c.videoSettings.height.max&&(p.maxHeight=c.videoSettings.height.max),c.videoSettings.height.min&&(p.minHeight=c.videoSettings.height.min)):p.maxHeight=c.videoSettings.height);f.facingMode=l,f.deviceId=c.videoSettings.deviceId,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var w={audio:!1,video:p};navigator.mediaDevices||window.MediaStreamTrack.getSources?navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!1,video:f}).then(h,m):window.MediaStreamTrack.getSources((function(e){var t=f.facingMode;l&&l.exact&&(t=l.exact);for(var i=0;i<e.length;i++)if("video"===e[i].kind&&e[i].facing===t){w.video.mandatory.sourceId=e[i].id;break}l&&l.exact&&!w.video.mandatory.sourceId?m("Failed to get camera facing the wanted direction"):navigator.getUserMedia?navigator.getUserMedia(w,h,m):m("navigator.getUserMedia is not supported on your browser")})):navigator.getUserMedia?navigator.getUserMedia(w,h,m):m("navigator.getUserMedia is not supported on your browser")}(0,a,m,l,o,{statsMain:d,statsWorker:s,stats:n},r)}))},e.prototype.add=function(e){this.root.add(e)},e.prototype.loadModel=function(e,t,i,a,n){var o,r=this.root;(new THREE.GLTFLoader).load(e,(function(e){(o=e.scene).scale.set(n,n,n),o.rotation.x=Math.PI/2,o.position.x=t,o.position.y=i,o.position.z=a,o.matrixAutoUpdate=!1,r.add(o)}))},e._teardownVideo=function(e){e.srcObject.getVideoTracks()[0].stop(),e.srcObject=null,e.src=null};var t={delta:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],interpolated:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},i=function(e,t){var i=[];for(var a in t)i[a]=t[a];"function"==typeof e.elements.set?e.elements.set(i):e.elements=[].slice.call(i)};window.ARnft=e,window.THREE=THREE}();