!function(){"use strict";var e=function(e,t,i){this.width=e,this.height=t,this.root=new THREE.Object3D,this.root.matrixAutoUpdate=!1,this.config=i};e.prototype.init=function(e,a){console.log("ARnft init() %cstart...","color: yellow; background-color: blue; border-radius: 4px; padding: 2px");this.cameraPara;var n=this.root;(async function(e,t){return await new Promise((function(t,i){const a=new XMLHttpRequest;a.open("GET",e),a.responseType="json",a.onload=function(){t(a.response)},a.onerror=function(){i("error "+a.status)},a.send(null)}))})(this.config).then((function(o){!function(e){var t=document.createElement("div");t.id="loading";var i=document.createElement("img");i.src=e.loading.logo.src,i.alt=e.loading.logo.alt;var a=document.createElement("span");a.setAttribute("class","loading-text"),a.innerText=e.loading.loadingMessage,t.appendChild(i),t.appendChild(a);document.getElementById("marker");document.body.insertBefore(t,document.body.firstChild)}(o),function(e){if(e){var t=document.createElement("div");t.id="stats",t.className="ui stats";var i=document.createElement("div");i.id="stats1",i.className="stats-item";var a=document.createElement("p");a.className="stats-item-title",a.innerText="Main",i.appendChild(a),t.appendChild(i);var n=document.createElement("div");n.id="stats2",n.className="stats-item";var o=document.createElement("p");o.className="stats-item-title",o.innerText="Worker",n.appendChild(o),t.appendChild(n);var r=document.getElementById("loading");document.body.insertBefore(t,r)}}(a);var r,d,s=function(){var e=document.createElement("div");e.id="app";var t=document.createElement("canvas");t.id="canvas";var i=document.createElement("video");i.id="video",i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.setAttribute("playsinline",""),e.appendChild(i),e.appendChild(t);var a=document.getElementById("loading");return document.body.insertBefore(e,a),{container:e,canvas:t,video:i}}(),c=(s.container,s.canvas),l=s.video;a&&((r=new Stats).showPanel(0),document.getElementById("stats1").appendChild(r.dom),(d=new Stats).showPanel(0),document.getElementById("stats2").appendChild(d.dom)),function(e,a,n,o,r,d,s){var c=s.videoSettings.facingMode||"environment",l=s.onError||function(e){console.error("ARnft internal getUserMedia",e)},m=!1,u=["touchstart","touchend","touchmove","touchcancel","click","mousedown","mouseup","mousemove","keydown","keyup","keypress","scroll"],v=function(){m&&(n.play().then((function(){!function(e,a,n,o,r,d,s,c,l,m){var u,v,g,h,p,f,w,E,y,x,b,M,S,k=document.createElement("canvas"),U=k.getContext("2d"),R=new THREE.WebGLRenderer({canvas:d,alpha:m.renderer.alpha,antialias:m.renderer.antialias,precision:m.renderer.precision});R.setPixelRatio(window.devicePixelRatio);var T=new THREE.Scene,H=new THREE.Camera;H.matrixAutoUpdate=!1,T.add(H);var A=new THREE.AmbientLight(16777215);T.add(A),T.add(l);var C,I=function(e){C=e?JSON.parse(e.matrixGL_RH):null},L=Date.now();function W(){U.fillStyle="black",U.fillRect(0,0,y,x),U.drawImage(n,0,0,u,v,b,M,w,E);var e=U.getImageData(0,0,y,x);S.postMessage({type:"process",imagedata:e},[e.data.buffer])}var P=function(){j(),requestAnimationFrame(P)},j=function(){s();var e=Date.now();if(e-L,L=e,C){l.visible=!0;for(var a=0;a<16;a++)t.delta[a]=C[a]-t.interpolated[a],t.interpolated[a]=t.interpolated[a]+t.delta[a]/24;i(l.matrix,t.interpolated)}else l.visible=!1;R.render(T,H)};u=o,v=r,p=320/Math.max(u,v/3*4),f=/Android|mobile|iPad|iPhone/i.test(navigator.userAgent)?window.outerWidth/o:1,g=u*f,h=v*f,w=u*p,E=v*p,y=Math.max(w,E/3*4),x=Math.max(E,w/4*3),b=(y-w)/2,M=(x-E)/2,k.style.clientWidth=y+"px",k.style.clientHeight=x+"px",k.width=y,k.height=x,R.setSize(g,h),(S=new Worker(m.workerUrl)).postMessage({type:"load",pw:y,ph:x,camera_para:m.cameraPara,marker:a,artoolkitUrl:m.artoolkitUrl}),S.onmessage=function(e){var t=e.data;switch(t.type){case"loaded":var a=JSON.parse(t.proj),n=y/w,o=x/E;a[0]*=n,a[4]*=n,a[8]*=n,a[12]*=n,a[1]*=o,a[5]*=o,a[9]*=o,a[13]*=o,i(H.projectionMatrix,a);break;case"endLoading":if(1==t.end){var r=document.getElementById("loading");r&&(r.querySelector(".loading-text").innerText="Start the tracking!",setTimeout((function(){r.parentElement.removeChild(r)}),2e3))}break;case"found":I(t);break;case"not found":I(null)}c(),W()},P(),W()}(0,a,n,n.videoWidth,n.videoHeight,o,(function(){d.stats&&d.statsMain.update()}),(function(){d.stats&&d.statsWorker.update()}),r,s)})).catch((function(e){l(e),n.stop()})),n.paused||u.forEach((function(e){window.removeEventListener(e,v,!0)})))};u.forEach((function(e){window.addEventListener(e,v,!0)}));var g=function(e){if(window.URL.createObjectURL)try{n.srcObject=e}catch(e){}n.srcObject=e,m=!0,n.autoplay=!0,n.playsInline=!0,v()},h={},p={};s.videoSettings.width&&(p.width=s.videoSettings.width,"object"==typeof s.videoSettings.width?(s.videoSettings.width.max&&(h.maxWidth=s.videoSettings.width.max),s.videoSettings.width.min&&(h.minWidth=s.videoSettings.width.min)):h.maxWidth=s.videoSettings.width);s.videoSettings.height&&(p.height=s.videoSettings.height,"object"==typeof s.videoSettings.height?(s.videoSettings.height.max&&(h.maxHeight=s.videoSettings.height.max),s.videoSettings.height.min&&(h.minHeight=s.videoSettings.height.min)):h.maxHeight=s.videoSettings.height);p.facingMode=c,p.deviceId=s.videoSettings.deviceId,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var f={audio:!1,video:h};navigator.mediaDevices||window.MediaStreamTrack.getSources?navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!1,video:p}).then(g,l):window.MediaStreamTrack.getSources((function(e){var t=p.facingMode;c&&c.exact&&(t=c.exact);for(var i=0;i<e.length;i++)if("video"===e[i].kind&&e[i].facing===t){f.video.mandatory.sourceId=e[i].id;break}c&&c.exact&&!f.video.mandatory.sourceId?l("Failed to get camera facing the wanted direction"):navigator.getUserMedia?navigator.getUserMedia(f,g,l):l("navigator.getUserMedia is not supported on your browser")})):navigator.getUserMedia?navigator.getUserMedia(f,g,l):l("navigator.getUserMedia is not supported on your browser")}(0,e,l,c,n,{statsMain:r,statsWorker:d,stats:a},o)}))},e.prototype.add=function(e){this.root.add(e)},e.prototype.loadModel=function(e,t,i,a,n){var o,r=this.root;(new THREE.GLTFLoader).load(e,(function(e){(o=e.scene).scale.set(n,n,n),o.rotation.x=Math.PI/2,o.position.x=t,o.position.y=i,o.position.z=a,o.matrixAutoUpdate=!1,r.add(o)}))};var t={delta:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],interpolated:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},i=function(e,t){var i=[];for(var a in t)i[a]=t[a];"function"==typeof e.elements.set?e.elements.set(i):e.elements=[].slice.call(i)};window.ARnft=e,window.THREE=THREE}();